{"version":3,"file":"datastore.js","sources":["../src/google-api.ts","../src/datastore.ts"],"sourcesContent":["import googleOneTap from \"google-one-tap\";\nimport { loadGapiInsideDOM, gapi } from \"gapi-script\";\n\n// mosfez-datastore-client\nconst client_id =\n  \"857300403927-e2g40elluaj1es7ovehsqf7absa56ln6.apps.googleusercontent.com\";\n\nasync function loadGapi() {\n  await loadGapiInsideDOM();\n  return gapi;\n}\n\ntype GoogleOneTapResponse = {\n  clientId: string;\n  credential: string;\n  select_by: string;\n};\n\nasync function loadGis(): Promise<GoogleOneTapResponse> {\n  return new Promise((resolve) => googleOneTap({ client_id }, resolve));\n}\n\nfunction initTokenClient() {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const { google } = <any>window;\n  if (!google) throw new Error(\"google not found on window\");\n\n  return google.accounts.oauth2.initTokenClient({\n    client_id: client_id,\n    scope: \"https://www.googleapis.com/auth/drive\",\n    prompt: \"consent\",\n    callback: \"\", // defined at request time in await/promise scope.\n  });\n}\n\nexport class GoogleApi {\n  async init() {\n    const gapi = await loadGapi();\n\n    await new Promise((callback, onerror) => {\n      gapi.load(\"client\", { callback, onerror });\n    });\n\n    await gapi.client.init({});\n    gapi.client.load(\n      \"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\"\n    );\n\n    await loadGis();\n\n    const tokenClient = initTokenClient();\n\n    console.log(\"hi\", tokenClient);\n\n    async function getToken(err) {\n      if (\n        err.result.error.code == 401 ||\n        (err.result.error.code == 403 &&\n          err.result.error.status == \"PERMISSION_DENIED\")\n      ) {\n        // The access token is missing, invalid, or expired, prompt for user consent to obtain one.\n        await new Promise((resolve, reject) => {\n          try {\n            // Settle this promise in the response callback for requestAccessToken()\n            tokenClient.callback = (resp) => {\n              if (resp.error !== undefined) {\n                reject(resp);\n              }\n              // GIS has automatically updated gapi.client with the newly issued access token.\n              console.log(\n                \"gapi.client access token: \" +\n                  JSON.stringify(gapi.client.getToken())\n              );\n              resolve(resp);\n            };\n            tokenClient.requestAccessToken();\n          } catch (err) {\n            console.log(err);\n          }\n        });\n      } else {\n        // Errors unrelated to authorization: server errors, exceeding quota, bad requests, and so on.\n        throw new Error(err);\n      }\n    }\n\n    async function listFiles() {\n      return await new Promise((resolve) => {\n        gapi.client.drive.files\n          .list({\n            pageSize: 10,\n            fields: \"files(id,version,name)\",\n            q: \"trashed=false\",\n          })\n          .execute(resolve);\n      });\n    }\n\n    listFiles()\n      .then((response) => console.log(response))\n      .catch((err) => getToken(err)) // for authorization errors obtain an access token\n      .then(() => listFiles())\n      .then((response) => console.log(response))\n      .catch((err) => console.log(err)); // cancelled by user, timeout, etc.\n  }\n}\n","import { GoogleApi } from \"./google-api\";\n\nexport class DataStore {\n  async init() {\n    const g = new GoogleApi();\n    await g.init();\n  }\n}\n"],"names":["loadGapiInsideDOM","gapi","googleOneTap"],"mappings":"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"}